<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trading Sessions Dashboard</title>

  <style>
    /* =========================
       THEME SYSTEM
       - Theme is applied on <html data-theme="...">
       - Add more themes by extending [data-theme="..."]
       ========================= */
    :root{
      --radius: 18px;
      --radius-sm: 14px;
      --shadow: 0 18px 55px rgba(0,0,0,.35);

      /* layout */
      --maxw: 1200px;
      --gap: 12px;

      /* motion */
      --ease: cubic-bezier(.2,.8,.2,1);
    }

    /* Default theme: midnight */
    html[data-theme="midnight"]{
      --bg0:#070a11;
      --bg1:#0b1220;
      --card: rgba(255,255,255,.055);
      --card2: rgba(255,255,255,.035);
      --line: rgba(255,255,255,.10);

      --text:#e5e7eb;
      --muted:#9ca3af;

      --accent:#60a5fa;
      --ok:#22c55e;
      --warn:#f59e0b;
      --soon:#a78bfa;

      --asia: rgba(96,165,250,.16);
      --london: rgba(34,197,94,.14);
      --overlap: rgba(245,158,11,.16);
      --ny: rgba(167,139,250,.16);

      --gold: rgba(245,158,11,.16);
      --goldText: #ffd28a;
    }

    html[data-theme="slate"]{
      --bg0:#0b1020;
      --bg1:#0e1629;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.04);
      --line: rgba(255,255,255,.12);

      --text:#eef2ff;
      --muted:#aab2c5;

      --accent:#38bdf8;
      --ok:#34d399;
      --warn:#fbbf24;
      --soon:#c4b5fd;

      --asia: rgba(56,189,248,.16);
      --london: rgba(52,211,153,.14);
      --overlap: rgba(251,191,36,.16);
      --ny: rgba(196,181,253,.16);

      --gold: rgba(251,191,36,.16);
      --goldText: #ffe3a8;
    }

    /* Accent-forward palettes (glass stays the same, but all accents adapt) */
    html[data-theme="ocean"]{
      --bg0:#06101a;
      --bg1:#081c2c;
      --card: rgba(255,255,255,.055);
      --card2: rgba(255,255,255,.035);
      --line: rgba(255,255,255,.10);

      --text:#e6f3ff;
      --muted:#a6c2d8;

      --accent:#38bdf8; /* blue */
      --ok:#22c55e;
      --warn:#f59e0b;
      --soon:#60a5fa;

      --asia: rgba(56,189,248,.16);
      --london: rgba(34,197,94,.14);
      --overlap: rgba(245,158,11,.16);
      --ny: rgba(96,165,250,.16);

      --gold: rgba(245,158,11,.16);
      --goldText: #ffe3a8;
    }

    html[data-theme="emerald"]{
      --bg0:#06120c;
      --bg1:#081f16;
      --card: rgba(255,255,255,.055);
      --card2: rgba(255,255,255,.035);
      --line: rgba(255,255,255,.10);

      --text:#e7fff3;
      --muted:#a8d7be;

      --accent:#34d399; /* green */
      --ok:#22c55e;
      --warn:#f59e0b;
      --soon:#86efac;

      --asia: rgba(52,211,153,.16);
      --london: rgba(34,197,94,.14);
      --overlap: rgba(245,158,11,.16);
      --ny: rgba(134,239,172,.14);

      --gold: rgba(245,158,11,.16);
      --goldText: #ffe3a8;
    }

    html[data-theme="royal"]{
      --bg0:#0a0818;
      --bg1:#120b2a;
      --card: rgba(255,255,255,.055);
      --card2: rgba(255,255,255,.035);
      --line: rgba(255,255,255,.10);

      --text:#f0ecff;
      --muted:#c1b6e3;

      --accent:#a78bfa; /* purple */
      --ok:#22c55e;
      --warn:#f59e0b;
      --soon:#c4b5fd;

      --asia: rgba(167,139,250,.16);
      --london: rgba(34,197,94,.14);
      --overlap: rgba(245,158,11,.16);
      --ny: rgba(196,181,253,.16);

      --gold: rgba(245,158,11,.16);
      --goldText: #ffe3a8;
    }

    html[data-theme="ruby"]{
      --bg0:#16070b;
      --bg1:#240a12;
      --card: rgba(255,255,255,.055);
      --card2: rgba(255,255,255,.035);
      --line: rgba(255,255,255,.10);

      --text:#ffe7ef;
      --muted:#e2a9b9;

      --accent:#fb7185; /* red/pink */
      --ok:#22c55e;
      --warn:#f59e0b;
      --soon:#fda4af;

      --asia: rgba(251,113,133,.14);
      --london: rgba(34,197,94,.14);
      --overlap: rgba(245,158,11,.16);
      --ny: rgba(253,164,175,.14);

      --gold: rgba(245,158,11,.16);
      --goldText: #ffe3a8;
    }

    html[data-theme="light"]{
      --bg0:#f7f7fb;
      --bg1:#ffffff;
      --card: rgba(17,24,39,.06);
      --card2: rgba(17,24,39,.04);
      --line: rgba(17,24,39,.12);

      --text:#0b1220;
      --muted:#374151;

      --accent:#2563eb;
      --ok:#16a34a;
      --warn:#d97706;
      --soon:#7c3aed;

      --asia: rgba(37,99,235,.10);
      --london: rgba(22,163,74,.10);
      --overlap: rgba(217,119,6,.10);
      --ny: rgba(124,58,237,.10);

      --gold: rgba(217,119,6,.10);
      --goldText: #7a3b00;
      --shadow: 0 18px 55px rgba(0,0,0,.12);
    }

    /* =========================
       BASE
       ========================= */
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 16% -10%, color-mix(in srgb, var(--accent) 20%, transparent), transparent 60%),
        radial-gradient(950px 700px at 90% 10%, color-mix(in srgb, var(--warn) 18%, transparent), transparent 60%),
        radial-gradient(900px 650px at 50% 110%, color-mix(in srgb, var(--ok) 12%, transparent), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      min-height:100vh;
    }

    .wrap{max-width:var(--maxw);margin:0 auto;padding:16px 12px 34px}
    .topbar{display:flex;gap:12px;align-items:flex-end;justify-content:space-between;flex-wrap:wrap}
    h1{margin:0;font-size:22px;letter-spacing:.2px}
    .subtitle{color:var(--muted);font-size:12px;margin-top:6px;line-height:1.25}

    /* Glass utility */
    .glass{
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--card), var(--card2));
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
    }

    .btn{
      border:1px solid var(--line);
      background: color-mix(in srgb, var(--card) 60%, transparent);
      color:var(--text);
      padding:10px 12px;border-radius:14px;
      cursor:pointer;
      transition: transform .12s var(--ease), background .12s var(--ease), border-color .12s var(--ease);
      text-decoration:none;
      display:inline-flex;gap:8px;align-items:center;
    }
    .btn:hover{background: color-mix(in srgb, var(--card) 80%, transparent); transform: translateY(-1px);}
    .btn:active{transform: translateY(0px);}

    .ctrls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .select{
      appearance:none;
      border:1px solid var(--line);
      background: color-mix(in srgb, var(--card) 60%, transparent);
      color:var(--text);
      padding:10px 36px 10px 12px;
      border-radius:14px;
      outline:none;
      cursor:pointer;
    }
    .selectWrap{position:relative}
    .selectWrap:after{
      content:"‚ñæ";
      position:absolute;right:12px;top:50%;
      transform:translateY(-50%);
      color:var(--muted);pointer-events:none;
      font-size:12px;
    }

    .grid{display:grid;gap:var(--gap);margin-top:14px}
    .cards{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width: 980px){ .cards{grid-template-columns:1fr} }

    .card{padding:14px;position:relative;overflow:hidden}
    .card:before{
      content:"";
      position:absolute;inset:-2px;
      background: radial-gradient(500px 180px at 10% 0%, color-mix(in srgb, var(--accent) 16%, transparent), transparent 60%);
      opacity:.6;
      pointer-events:none;
    }
    .clockLabel{font-size:12px;color:var(--muted)}
    .clockTime{font-size:30px;font-weight:900;letter-spacing:.5px;margin-top:4px}
    .clockMeta{margin-top:6px;font-size:12px;color:var(--muted)}

    .searchRow{display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap}
    .search{
      flex:1;min-width:220px;
      border:1px solid var(--line);
      background: color-mix(in srgb, var(--card) 55%, transparent);
      color:var(--text);
      padding:10px 12px;border-radius:14px;
      outline:none;
    }
    .toggle{
      display:flex;gap:8px;align-items:center;
      border:1px solid var(--line);
      border-radius:14px;
      padding:8px 10px;
      background: color-mix(in srgb, var(--card) 55%, transparent);
      color:var(--muted);
      font-size:12px;
      user-select:none;
    }
    .toggle input{accent-color:var(--accent)}

    .panelTitle{display:flex;align-items:center;justify-content:space-between;margin-top:16px;margin-bottom:8px}
    .panelTitle h2{margin:0;font-size:13px;color:var(--muted);font-weight:800;letter-spacing:.24px}
    .panelTitle .mini{font-size:12px;color:var(--muted)}

    /* Tables */
    /* Prevent right-side clipping on smaller widths.
       Keep compact, no-wrap cells, but allow horizontal scroll as a safe fallback
       (GitHub Pages friendly, deterministic, minimal reflow). */
    .tableWrap{overflow-x:auto; overflow-y:hidden; -webkit-overflow-scrolling:touch}
    table{width:100%;border-collapse:collapse; table-layout:fixed}
    thead th{
      text-align:left;
      font-size:12px;
      padding:12px;
      color:var(--muted);
      background: color-mix(in srgb, var(--card) 65%, transparent);
      border-bottom:1px solid var(--line);
      position:sticky; top:0;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      white-space:nowrap;
    }
    tbody td{
      padding:12px;
      border-bottom:1px solid color-mix(in srgb, var(--line) 60%, transparent);
      vertical-align:top;
      font-size:13px;
      line-height:1.25;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    tbody tr{transition: background .15s var(--ease)}
    tbody tr{height:54px; cursor:pointer}
    tbody tr:hover{background: color-mix(in srgb, var(--card) 40%, transparent)}
    tbody tr:last-child td{border-bottom:none}

    /* Pair cell */
    .pairRow{
      display:flex;align-items:center;gap:10px;
      font-weight:900;
    }
    .pairMeta{display:flex;align-items:center;gap:8px;margin-left:auto}
    .pairIcon{
      width:26px;height:26px;border-radius:999px;
      display:inline-flex;align-items:center;justify-content:center;
      border:1px solid var(--line);
      background: color-mix(in srgb, var(--card) 70%, transparent);
      font-size:14px;
      flex:0 0 26px;
      box-shadow: 0 10px 26px rgba(0,0,0,.15);
    }
    .goldBadge{
      display:inline-flex;align-items:center;gap:8px;
      font-size:11px;
      padding:4px 10px;border-radius:999px;
      border:1px solid color-mix(in srgb, var(--warn) 45%, transparent);
      background: color-mix(in srgb, var(--warn) 14%, transparent);
      color: var(--goldText);
      font-weight:900;
      position:relative;
      overflow:hidden;
    }
    .goldBadge .flame{
      display:inline-block;
      transform-origin:50% 100%;
      animation: flameFloat 1.15s var(--ease) infinite;
      filter: drop-shadow(0 0 10px color-mix(in srgb, var(--warn) 60%, transparent));
    }
    @keyframes flameFloat{
      0%{ transform: translateY(0) rotate(-6deg) scale(.95); opacity:.95 }
      50%{ transform: translateY(-2px) rotate(6deg) scale(1.05); opacity:1 }
      100%{ transform: translateY(0) rotate(-6deg) scale(.95); opacity:.95 }
    }
    /* Subtle glow on golden rows */
    .heat-goldGlow{
      box-shadow:
        inset 0 0 0 9999px var(--gold),
        inset 0 0 0 1px color-mix(in srgb, var(--warn) 25%, transparent);
    }

    .journalLink{
      font-size:12px;
      color:var(--muted);
      text-decoration:none;
      border:1px solid var(--line);
      padding:5px 9px;border-radius:12px;
      background: color-mix(in srgb, var(--card) 55%, transparent);
      transition: background .12s var(--ease);
      white-space:nowrap;
    }
    .journalLink:hover{background: color-mix(in srgb, var(--card) 80%, transparent);}

    /* Status */
    .statusPill{
      display:inline-flex;align-items:center;gap:8px;
      border:1px solid var(--line);
      border-radius:999px;
      padding:7px 11px;
      font-size:12px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .dot{width:8px;height:8px;border-radius:999px;background:var(--muted);box-shadow:0 0 0 3px rgba(255,255,255,.02)}
    .dot.live{background:var(--ok)}
    .dot.up{background:var(--warn)}
    .status-live{border-color:color-mix(in srgb, var(--ok) 50%, transparent); background: color-mix(in srgb, var(--ok) 12%, transparent)}
    .status-up{border-color:color-mix(in srgb, var(--warn) 50%, transparent); background: color-mix(in srgb, var(--warn) 12%, transparent)}

    /* Session heat */
    .heat-asia{background:linear-gradient(90deg,var(--asia), transparent 58%)}
    .heat-london{background:linear-gradient(90deg,var(--london), transparent 58%)}
    .heat-overlap{background:linear-gradient(90deg,var(--overlap), transparent 58%)}
    .heat-ny{background:linear-gradient(90deg,var(--ny), transparent 58%)}

    /* Mobile cards */
    .mobileList{display:none}
    @media (max-width: 900px){
      .desktopOnly{display:none}
      .mobileList{display:grid;gap:10px}
      .mCard{padding:12px}
      .mTop{display:flex;gap:10px;align-items:flex-start;justify-content:space-between}
      .mPair{font-weight:1000;display:flex;gap:10px;align-items:center}
      .mMeta{color:var(--muted);font-size:12px;margin-top:3px}
      .mRow{display:flex;gap:10px;margin-top:10px}
      .mK{width:120px;flex:0 0 120px;color:var(--muted);font-size:12px}
      .mV{font-size:12px}
    }

    .muted{color:var(--muted)}

    /* =========================
       Details modal
       ========================= */
    .modalOverlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.45);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:999;
    }
    .modalOverlay[data-open="1"]{display:flex}
    .modal{
      width:min(860px, 100%);
      max-height: min(86vh, 820px);
      overflow:hidden;
      border-radius: 20px;
    }
    .modalHead{
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between;
      padding:14px;
      border-bottom: 1px solid var(--line);
    }
    .modalTitle{
      display:flex; gap:10px; align-items:center;
      font-weight:1000;
      font-size:16px;
    }
    .modalSub{margin-top:4px; color:var(--muted); font-size:12px}
    .modalClose{
      border:1px solid var(--line);
      background: color-mix(in srgb, var(--card) 60%, transparent);
      color:var(--text);
      border-radius: 14px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:900;
    }
    .modalBody{
      padding:14px;
      overflow:auto;
      max-height: calc(min(86vh, 820px) - 64px);
    }
    .modalGrid{display:grid; gap:12px}
    .modalRow{display:grid; gap:10px; grid-template-columns: 1fr 1fr}
    @media (max-width: 720px){ .modalRow{grid-template-columns:1fr} }
    .kv{
      padding:12px;
    }
    .k{color:var(--muted); font-size:12px}
    .v{margin-top:6px; font-weight:900; font-size:13px}
    .chartBox{
      padding:12px;
      border:1px solid var(--line);
      border-radius:16px;
      background: color-mix(in srgb, var(--card) 55%, transparent);
      min-height: 140px;
      display:flex;
      flex-direction:column;
      gap:10px;
      justify-content:center;
      align-items:flex-start;
    }
    .bigBox{
      width:100%;
      border:1px solid var(--line);
      border-radius:16px;
      background: color-mix(in srgb, var(--card) 55%, transparent);
      color:var(--text);
      padding:12px;
      min-height: 110px;
      resize: vertical;
      font-family: inherit;
      font-size: 13px;
      outline:none;
    }
    .modalActions{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .modalBtn{
      border:1px solid var(--line);
      background: color-mix(in srgb, var(--card) 60%, transparent);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      text-decoration:none;
      display:inline-flex; gap:8px; align-items:center;
    }
    .modalBtn.primary{border-color: color-mix(in srgb, var(--accent) 55%, transparent)}
    .modalBtn.ok{border-color: color-mix(in srgb, var(--ok) 55%, transparent)}

    /* Clickable rows (primary UX rule) */
    tr[data-idx]{cursor:pointer}
    tr[data-idx]:active{transform: translateY(0.5px)}

    /* =========================
       Modal (Details Popup)
       ========================= */
    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding:14px;
      z-index:9999;
    }
    .modalBack.show{display:flex}
    .modal{
      width:min(980px, 100%);
      max-height: 92vh;
      overflow:auto;
      border-radius: 22px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--card), var(--card2));
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      box-shadow: var(--shadow);
      padding: 14px;
      transform: translateY(14px);
      animation: popIn .16s var(--ease) forwards;
    }
    @keyframes popIn{to{transform: translateY(0)}}
    .mHead{display:flex; gap:10px; align-items:flex-start; justify-content:space-between}
    .mTitle{display:flex; gap:10px; align-items:center; font-weight:1000}
    .mTitle .pairTxt{font-size:16px}
    .mTitle .sessTxt{color:var(--muted); font-size:12px; font-weight:800}
    .mActions{display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end}
    .xBtn{
      border:1px solid var(--line);
      background: color-mix(in srgb, var(--card) 65%, transparent);
      color:var(--text);
      padding:8px 10px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:900;
    }
    .xBtn:hover{background: color-mix(in srgb, var(--card) 82%, transparent)}
    .mGrid{display:grid; gap:12px; margin-top:12px}
    .mGrid.two{grid-template-columns: repeat(2,minmax(0,1fr))}
    @media (max-width: 900px){
      .modalBack{align-items:stretch}
      .modal{max-height:100vh}
      .mGrid.two{grid-template-columns: 1fr}
    }
    .mBox{padding:12px}
    .mK{color:var(--muted); font-size:12px; font-weight:900; letter-spacing:.2px}
    .mV{margin-top:6px; font-size:13px}
    .mArea{
      width:100%;
      min-height: 110px;
      resize: vertical;
      border:1px solid color-mix(in srgb, var(--line) 85%, transparent);
      background: color-mix(in srgb, var(--card) 55%, transparent);
      color:var(--text);
      border-radius: 16px;
      padding: 10px 12px;
      outline:none;
      line-height:1.35;
      font-family: inherit;
      font-size: 13px;
      white-space: pre-wrap;
    }
    .chartBox{
      padding:12px;
      min-height:140px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .chartHint{color:var(--muted); font-size:12px; line-height:1.35}
    .miniLink{
      text-decoration:none;
      border:1px solid var(--line);
      background: color-mix(in srgb, var(--card) 60%, transparent);
      color:var(--text);
      padding:8px 10px;
      border-radius: 14px;
      font-weight:900;
      white-space:nowrap;
    }
    .miniLink:hover{background: color-mix(in srgb, var(--card) 82%, transparent)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <h1>Trading Sessions Dashboard</h1>
        <div class="subtitle">Live clocks ‚Ä¢ live windows ‚Ä¢ countdowns (Paris-based) ‚Ä¢ mobile-first</div>
      </div>

      <div class="ctrls">
        <div class="selectWrap" title="Theme">
          <select class="select" id="themeSel">
            <option value="midnight">Midnight</option>
            <option value="slate">Slate</option>
            <option value="ocean">Ocean Blue</option>
            <option value="emerald">Emerald Green</option>
            <option value="royal">Royal Purple</option>
            <option value="ruby">Ruby Red</option>
            <option value="light">Light</option>
          </select>
        </div>

        <a class="btn" href="./editor.html" title="Edit config">
          ‚úèÔ∏è <span>Open Editor</span>
        </a>
      </div>
    </div>

    <div class="grid cards">
      <div class="card glass" id="cardParis">
        <div class="clockLabel">Paris Time</div>
        <div class="clockTime" id="tParis">--:--:--</div>
        <div class="clockMeta" id="dParis">--</div>
      </div>

      <div class="card glass" id="cardNY">
        <div class="clockLabel">New York Time</div>
        <div class="clockTime" id="tNY">--:--:--</div>
        <div class="clockMeta" id="dNY">--</div>
      </div>

      <div class="card glass" id="cardIST">
        <div class="clockLabel">IST Time</div>
        <div class="clockTime" id="tIST">--:--:--</div>
        <div class="clockMeta" id="dIST">--</div>
      </div>
    </div>

    <div class="searchRow">
      <input class="search" id="q" placeholder="Search pair / session (e.g., XAUUSD, London, overlap)..." />
      <label class="toggle" title="Show only LIVE rows">
        <input type="checkbox" id="onlyLive" />
        Only LIVE
      </label>
      <label class="toggle" title="Show only GOLDEN rows">
        <input type="checkbox" id="onlyGold" />
        Only GOLDEN
      </label>
    </div>

    <div class="panelTitle">
      <h2>LIVE NOW</h2>
      <div class="mini" id="liveMeta">‚Äî</div>
    </div>

    <div class="mobileList" id="liveMobile"></div>
    <div class="tableWrap glass desktopOnly">
      <table>
        <thead>
          <tr>
            <th style="width:130px">Session</th>
            <th style="width:230px">Pair</th>
            <th style="width:95px">Chart TF</th>
            <th style="width:150px">Best Window (Paris)</th>
            <th style="width:150px">IST Window</th>
            <th style="width:105px">Status</th>
            <th style="width:125px">Countdown</th>
            <th style="width:170px">Tight Rules</th>
            <th>Comments</th>
          </tr>
        </thead>
        <tbody id="liveBody"></tbody>
      </table>
    </div>

    <div class="panelTitle">
      <h2>ALL PAIRS</h2>
      <div class="mini muted">Auto updates every second</div>
    </div>

    <div class="mobileList" id="allMobile"></div>
    <div class="tableWrap glass desktopOnly">
      <table>
        <thead>
          <tr>
            <th style="width:130px">Session</th>
            <th style="width:230px">Pair</th>
            <th style="width:95px">Chart TF</th>
            <th style="width:150px">Best Window (Paris)</th>
            <th style="width:150px">IST Window</th>
            <th style="width:105px">Status</th>
            <th style="width:125px">Countdown</th>
            <th style="width:170px">Tight Rules</th>
            <th>Comments</th>
          </tr>
        </thead>
        <tbody id="allBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Details popup modal (row click) -->
  <div class="modalOverlay" id="modalOverlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal glass" id="modalBox">
      <div class="modalHead">
        <div>
          <div class="modalTitle" id="mTitle">
            <span class="pairIcon" id="mIcon">üìà</span>
            <span id="mPair">‚Äî</span>
          </div>
          <div class="modalSub" id="mSub">‚Äî</div>
        </div>
        <button class="modalClose" id="mClose" title="Close">‚úñ</button>
      </div>

      <div class="modalBody">
        <div class="modalGrid">
          <div class="modalRow">
            <div class="kv glass">
              <div class="k">Status</div>
              <div class="v" id="mStatus">‚Äî</div>
            </div>
            <div class="kv glass">
              <div class="k">Countdown</div>
              <div class="v" id="mCountdown">‚Äî</div>
            </div>
          </div>

          <div class="modalRow">
            <div class="kv glass">
              <div class="k">Chart TF</div>
              <div class="v" id="mTF">‚Äî</div>
            </div>
            <div class="kv glass">
              <div class="k">Windows</div>
              <div class="v"><span id="mParisWin">‚Äî</span><br><span class="muted">IST:</span> <span id="mISTWin">‚Äî</span></div>
            </div>
          </div>

          <div class="chartBox glass">
            <div><b>Chart</b> (quick open)</div>
            <div class="muted" id="mChartHint">Open a live chart for this pair in a new tab.</div>
            <div class="modalActions" id="mChartActions"></div>
          </div>

          <div>
            <div class="k">Tight Rules</div>
            <textarea class="bigBox" id="mRules" placeholder="(rules / checklist)"></textarea>
          </div>

          <div>
            <div class="k">Comments</div>
            <textarea class="bigBox" id="mComments" placeholder="(comments)"></textarea>
          </div>

          <div>
            <div class="k">Notes</div>
            <textarea class="bigBox" id="mNotes" placeholder="(your notes for this pair)"></textarea>
            <div class="modalActions">
              <button class="modalBtn ok" id="mSaveNotes">üíæ Save Notes</button>
              <a class="modalBtn primary" id="mJournalBtn" target="_blank" rel="noopener" style="display:none">üìì Journal ‚Üó</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // =========================
  // Theme selection
  // =========================
  const THEME_KEY = "tsd_theme_v1";
  function applyTheme(theme){
    document.documentElement.setAttribute("data-theme", theme);
    localStorage.setItem(THEME_KEY, theme);
  }
  function initTheme(defaultTheme){
    const saved = localStorage.getItem(THEME_KEY);
    const theme = saved || defaultTheme || "midnight";
    applyTheme(theme);
    const sel = document.getElementById("themeSel");
    if(sel) sel.value = theme;
  }

  // =========================
  // Time / windows logic
  // =========================
  const TZ_PARIS = "Europe/Paris";
  const TZ_NY = "America/New_York";
  const TZ_IST = "Asia/Kolkata";

  function fmtTime(tz){
    return new Intl.DateTimeFormat("en-GB", { timeZone: tz, hour:"2-digit", minute:"2-digit", second:"2-digit" });
  }
  function fmtDate(tz){
    return new Intl.DateTimeFormat("en-GB", { timeZone: tz, weekday:"short", day:"2-digit", month:"short", year:"numeric" });
  }
  const fParis = fmtTime(TZ_PARIS), fNY = fmtTime(TZ_NY), fIST = fmtTime(TZ_IST);
  const dParisF = fmtDate(TZ_PARIS), dNYF = fmtDate(TZ_NY), dISTF = fmtDate(TZ_IST);

  function parseHHMM(s){
    const t = String(s||"").trim().toUpperCase().replace(":", "H");
    const [hh, mm] = t.split("H");
    return { h: Number(hh), m: Number(mm) };
  }

  function windowsFromText(text){
    return String(text||"")
      .split("/")
      .map(x => x.trim())
      .filter(Boolean)
      .map(seg=>{
        const [a,b] = seg.split("-").map(x=>x.trim());
        if(!a || !b) return null;
        return { s: parseHHMM(a), e: parseHHMM(b), label: `${a} - ${b}` };
      })
      .filter(Boolean);
  }

  function nowInTZ(tz){
    const parts = new Intl.DateTimeFormat("en-GB", {
      timeZone: tz, year:"numeric", month:"2-digit", day:"2-digit",
      hour:"2-digit", minute:"2-digit", second:"2-digit", hour12:false
    }).formatToParts(new Date()).reduce((acc,p)=> (acc[p.type]=p.value, acc), {});
    return {
      y: Number(parts.year),
      mo: Number(parts.month),
      d: Number(parts.day),
      h: Number(parts.hour),
      mi: Number(parts.minute),
      se: Number(parts.second)
    };
  }

  function msUntilInParis(targetHM){
    const n = nowInTZ(TZ_PARIS);
    const nowMin = n.h*60 + n.mi + n.se/60;
    const tMin = targetHM.h*60 + targetHM.m;
    let deltaMin = tMin - nowMin;
    if(deltaMin < 0) deltaMin += 24*60;
    return Math.max(0, deltaMin*60*1000);
  }

  function withinWindowParis(win){
    const n = nowInTZ(TZ_PARIS);
    const nowMin = n.h*60 + n.mi + n.se/60;
    const sMin = win.s.h*60 + win.s.m;
    const eMin = win.e.h*60 + win.e.m;
    if(eMin >= sMin) return nowMin >= sMin && nowMin <= eMin;
    return (nowMin >= sMin) || (nowMin <= eMin);
  }

  function countdownForRow(wins){
    const live = wins.find(withinWindowParis);
    if(live){
      return { status:"LIVE", ms: msUntilInParis(live.e), mode:"ends" };
    }
    let best = null;
    for(const w of wins){
      const ms = msUntilInParis(w.s);
      if(best === null || ms < best) best = ms;
    }
    return { status:"UPCOMING", ms: best ?? 0, mode:"starts" };
  }

  function msToHHMMSS(ms){
    const total = Math.max(0, Math.floor(ms/1000));
    const h = Math.floor(total/3600);
    const m = Math.floor((total%3600)/60);
    const s = total%60;
    const pad = n => String(n).padStart(2,"0");
    return `${pad(h)}:${pad(m)}:${pad(s)}`;
  }

  function heatClass(session, golden){
    const s = (session||"").toLowerCase();
    let c = "";
    if(s.includes("asian")) c = "heat-asia";
    else if(s.includes("london") && s.includes("overlap")) c = "heat-overlap";
    else if(s.includes("london")) c = "heat-london";
    else if(s.includes("new york")) c = "heat-ny";
    if(golden) c += " heat-goldGlow";
    return c.trim();
  }

  function statusPill(status){
    if(status === "LIVE") return `<span class="statusPill status-live"><span class="dot live"></span>LIVE</span>`;
    return `<span class="statusPill status-up"><span class="dot up"></span>UPCOMING</span>`;
  }

  function journalAnchor(url){
    if(!url) return "";
    return `<a class="journalLink" href="${url}" target="_blank" rel="noopener">Journal ‚Üó</a>`;
  }

  function escapeHtml(s){
    return String(s ?? "").replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }
  function oneLine(s){
    return escapeHtml(String(s||"").replace(/\s+/g," ").trim());
  }

  // =========================
  // Pair icons (emoji-based, zero external assets)
  // =========================
  const CCY_EMOJI = {
    USD:"üá∫üá∏", EUR:"üá™üá∫", GBP:"üá¨üáß", JPY:"üáØüáµ", AUD:"üá¶üá∫", NZD:"üá≥üáø",
    CAD:"üá®üá¶", CHF:"üá®üá≠", SEK:"üá∏üá™", NOK:"üá≥üá¥", DKK:"üá©üá∞",
    XAU:"üü°", XAG:"ü•à", BTC:"‚Çø", ETH:"‚óá"
  };

  function extractCorePairLabel(raw){
    const s = String(raw||"").trim();
    // take first token before spaces
    const token = s.split(" ")[0];
    // strip common suffixes/prefixes (keep letters/numbers)
    return token.replace(/[^A-Za-z0-9]/g,"").toUpperCase();
  }

  function pairIconHTML(pair){
    const core = extractCorePairLabel(pair);
    if(core.startsWith("XAU")) return `<span class="pairIcon" title="Gold">üü°</span>`;
    if(core.length >= 6){
      const base = core.slice(0,3);
      const quote = core.slice(3,6);
      const b = CCY_EMOJI[base] || base;
      const q = CCY_EMOJI[quote] || quote;
      // show base flag; tooltip includes pair
      return `<span class="pairIcon" title="${base}/${quote}">${b}</span>`;
    }
    // fallback
    return `<span class="pairIcon" title="Pair">üìà</span>`;
  }

  function pairEmoji(pair){
    const core = extractCorePairLabel(pair);
    if(core.startsWith("XAU")) return "üü°";
    if(core.length >= 6){
      const base = core.slice(0,3);
      return CCY_EMOJI[base] || "üìà";
    }
    return "üìà";
  }

  // =========================
  // Rendering
  // =========================
  let CFG = { schemaVersion: 2, defaultTheme: "midnight", rows: [] };

  async function loadConfig(){
    const res = await fetch("./config.json?x=" + Date.now());
    const json = await res.json();
    if(!json.rows) json.rows = [];
    json.rows = json.rows.map((r,i)=>({
      _idx: i,
      session: r.session ?? "",
      pair: r.pair ?? "",
      chartTF: r.chartTF ?? r.chartTimeFrame ?? "",
      bestWindowParis: r.bestWindowParis ?? r.bestCTE ?? "",
      istWindow: r.istWindow ?? "",
      golden: !!r.golden,
      tightRules: r.tightRules ?? "",
      comments: r.comments ?? "",
      journal: r.journal ?? ""
    }));
    return json;
  }

  function rowHTML(r){
    const wins = windowsFromText(r.bestWindowParis);
    const cd = countdownForRow(wins);
    const countdownTxt = `${cd.mode} in ${msToHHMMSS(cd.ms)}`;

    const heat = heatClass(r.session, !!r.golden);
    const gold = r.golden ? `<span class="goldBadge"><span class="flame">üî•</span> GOLD</span>` : "";
    const j = journalAnchor(r.journal);
    const icon = pairIconHTML(r.pair);

    return `
      <tr class="${heat}" data-idx="${r._idx}">
        <td>${r.session||""}</td>
        <td>
          <div class="pairRow">
            ${icon}
            <span class="pairName" data-open="1">${escapeHtml(r.pair||"")}</span>
            <span class="pairMeta">
              ${gold}
              ${j}
            </span>
          </div>
        </td>
        <td>${escapeHtml(r.chartTF||"")}</td>
        <td>${escapeHtml(r.bestWindowParis||"")}</td>
        <td>${escapeHtml(r.istWindow||"")}</td>
        <td>${statusPill(cd.status)}</td>
        <td>${escapeHtml(countdownTxt)}</td>
        <td>${oneLine(r.tightRules)}</td>
        <td>${oneLine(r.comments)}</td>
      </tr>
    `;
  }

  function mobileCardHTML(r){
    const wins = windowsFromText(r.bestWindowParis);
    const cd = countdownForRow(wins);
    const heat = heatClass(r.session, !!r.golden);
    const gold = r.golden ? ` <span class="goldBadge"><span class="flame">üî•</span> GOLD</span>` : "";
    const j = r.journal ? `<a class="journalLink" href="${r.journal}" target="_blank" rel="noopener">Journal ‚Üó</a>` : "";
    const countdownTxt = `${cd.mode} in ${msToHHMMSS(cd.ms)}`;
    const icon = pairIconHTML(r.pair);

    return `
      <div class="mCard glass ${heat}" data-idx="${r._idx}">
        <div class="mTop">
          <div>
            <div class="mPair">${icon}<span>${r.pair||""}</span>${gold}</div>
            <div class="mMeta">${r.session||""} ‚Ä¢ ${r.chartTF||""}</div>
          </div>
          <div>${j}</div>
        </div>

        <div class="mRow"><div class="mK">Paris Window</div><div class="mV">${r.bestWindowParis||""}</div></div>
        <div class="mRow"><div class="mK">IST Window</div><div class="mV">${r.istWindow||""}</div></div>
        <div class="mRow"><div class="mK">Status</div><div class="mV">${cd.status} ‚Ä¢ ${countdownTxt}</div></div>

        ${r.tightRules ? `<div class="mRow"><div class="mK">Rules</div><div class="mV">${String(r.tightRules).replace(/\n/g,"<br>")}</div></div>` : ``}
        ${r.comments ? `<div class="mRow"><div class="mK">Notes</div><div class="mV">${String(r.comments).replace(/\n/g,"<br>")}</div></div>` : ``}
      </div>
    `;
  }

  function render(){
    const q = document.getElementById("q").value.trim().toLowerCase();
    const onlyLive = document.getElementById("onlyLive").checked;
    const onlyGold = document.getElementById("onlyGold").checked;

    let rows = CFG.rows.slice();
    if(q){
      rows = rows.filter(r =>
        (r.pair||"").toLowerCase().includes(q) ||
        (r.session||"").toLowerCase().includes(q) ||
        (r.comments||"").toLowerCase().includes(q)
      );
    }
    if(onlyGold){
      rows = rows.filter(r => !!r.golden);
    }

    // compute live rows
    const liveRows = rows.filter(r => countdownForRow(windowsFromText(r.bestWindowParis)).status === "LIVE");
    document.getElementById("liveMeta").textContent = `${liveRows.length} live pair(s)`;

    // LIVE
    document.getElementById("liveBody").innerHTML = liveRows.map(rowHTML).join("") || `
      <tr><td colspan="9" class="muted">No LIVE pairs right now.</td></tr>
    `;
    document.getElementById("liveMobile").innerHTML = liveRows.map(mobileCardHTML).join("") || `<div class="muted">No LIVE pairs right now.</div>`;

    // ALL (optionally live only)
    const finalRows = onlyLive ? liveRows : rows;
    document.getElementById("allBody").innerHTML = finalRows.map(rowHTML).join("") || `
      <tr><td colspan="9" class="muted">No rows match your filters.</td></tr>
    `;
    document.getElementById("allMobile").innerHTML = finalRows.map(mobileCardHTML).join("") || `<div class="muted">No rows match your filters.</div>`;
  }

  function tickClocks(){
    const now = new Date();
    document.getElementById("tParis").textContent = fParis.format(now);
    document.getElementById("tNY").textContent = fNY.format(now);
    document.getElementById("tIST").textContent = fIST.format(now);

    document.getElementById("dParis").textContent = `${dParisF.format(now)} ‚Ä¢ ${TZ_PARIS}`;
    document.getElementById("dNY").textContent = `${dNYF.format(now)} ‚Ä¢ ${TZ_NY}`;
    document.getElementById("dIST").textContent = `${dISTF.format(now)} ‚Ä¢ ${TZ_IST}`;
  }

  async function main(){
    CFG = await loadConfig();
    initTheme(CFG.defaultTheme);

    // =========================
    // Details popup (row click)
    // =========================
    const overlay = document.getElementById("modalOverlay");
    const closeBtn = document.getElementById("mClose");
    const NOTES_KEY = "tsd_notes_v1";
    let activeIdx = null;

    function readNotesMap(){
      try{ return JSON.parse(localStorage.getItem(NOTES_KEY) || "{}"); }catch(e){ return {}; }
    }
    function writeNotesMap(map){
      localStorage.setItem(NOTES_KEY, JSON.stringify(map));
    }

    function tvUrl(pair){
      // Best-effort TradingView symbol mapping (keeps it simple; user can edit manually there)
      const core = extractCorePairLabel(pair);
      if(core.startsWith("XAU")) return "https://www.tradingview.com/symbols/XAUUSD/";
      if(core.length >= 6) return `https://www.tradingview.com/symbols/${core}/`;
      return "https://www.tradingview.com/";
    }

    function openDetails(idx){
      const row = CFG.rows.find(r => r._idx === idx);
      if(!row) return;

      activeIdx = idx;
      const wins = windowsFromText(row.bestWindowParis);
      const cd = countdownForRow(wins);
      const countdownTxt = `${cd.mode} in ${msToHHMMSS(cd.ms)}`;

      // Title + icon + session
      document.getElementById("mIcon").textContent = pairEmoji(row.pair);
      document.getElementById("mPair").textContent = row.pair || "‚Äî";
      document.getElementById("mSub").textContent = `${row.session || ""}${row.golden ? " ‚Ä¢ GOLD üî•" : ""}`.trim() || "‚Äî";

      // Status + countdown
      document.getElementById("mStatus").textContent = cd.status;
      document.getElementById("mCountdown").textContent = countdownTxt;

      // TF + windows
      document.getElementById("mTF").textContent = row.chartTF || "‚Äî";
      document.getElementById("mParisWin").textContent = row.bestWindowParis || "‚Äî";
      document.getElementById("mISTWin").textContent = row.istWindow || "‚Äî";

      // Big fields
      const rulesEl = document.getElementById("mRules");
      const comEl = document.getElementById("mComments");
      rulesEl.value = row.tightRules || "";
      comEl.value = row.comments || "";
      rulesEl.readOnly = true;
      comEl.readOnly = true;

      // Chart actions (external open; we don't load widgets)
      const chartActions = document.getElementById("mChartActions");
      chartActions.innerHTML = "";
      const a = document.createElement("a");
      a.className = "modalBtn primary";
      a.target = "_blank";
      a.rel = "noopener";
      a.href = tvUrl(row.pair);
      a.textContent = "üìà Open TradingView";
      chartActions.appendChild(a);

      const jBtn = document.getElementById("mJournalBtn");
      if(row.journal){
        jBtn.href = row.journal;
        jBtn.style.display = "inline-flex";
      }else{
        jBtn.style.display = "none";
      }

      // Notes (local only)
      const notesMap = readNotesMap();
      document.getElementById("mNotes").value = notesMap[row.pair] || "";

      overlay.setAttribute("data-open","1");
      overlay.setAttribute("aria-hidden","false");
    }

    function closeDetails(){
      overlay.removeAttribute("data-open");
      overlay.setAttribute("aria-hidden","true");
      activeIdx = null;
    }

    closeBtn.addEventListener("click", closeDetails);
    overlay.addEventListener("click", (e)=>{
      if(e.target === overlay) closeDetails();
    });
    window.addEventListener("keydown", (e)=>{
      if(e.key === "Escape") closeDetails();
    });

    document.getElementById("mSaveNotes").addEventListener("click", ()=>{
      if(activeIdx === null) return;
      const row = CFG.rows.find(r=>r._idx === activeIdx);
      if(!row) return;
      const map = readNotesMap();
      map[row.pair] = document.getElementById("mNotes").value;
      writeNotesMap(map);
    });

    // Event delegation: table rows
    function bindRowClicks(containerId){
      const el = document.getElementById(containerId);
      if(!el) return;
      el.addEventListener("click", (e)=>{
        const a = e.target.closest("a");
        if(a) return; // allow Journal ‚Üó links
        const tr = e.target.closest("tr[data-idx]");
        if(!tr) return;
        const idx = Number(tr.getAttribute("data-idx"));
        openDetails(idx);
      });
    }
    bindRowClicks("liveBody");
    bindRowClicks("allBody");

    // Event delegation: mobile cards
    function bindMobileClicks(containerId){
      const el = document.getElementById(containerId);
      if(!el) return;
      el.addEventListener("click", (e)=>{
        const a = e.target.closest("a");
        if(a) return;
        const card = e.target.closest("[data-idx]");
        if(!card) return;
        const idx = Number(card.getAttribute("data-idx"));
        openDetails(idx);
      });
    }
    bindMobileClicks("liveMobile");
    bindMobileClicks("allMobile");

    // theme change
    document.getElementById("themeSel").addEventListener("change", (e)=> applyTheme(e.target.value));

    tickClocks();
    render();
    setInterval(()=>{ tickClocks(); render(); }, 1000);

    document.getElementById("q").addEventListener("input", render);
    document.getElementById("onlyLive").addEventListener("change", render);
    document.getElementById("onlyGold").addEventListener("change", render);
  }
  main();
</script>
</body>
</html>
