<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trading Sessions Dashboard</title>
  <style>
    :root{
      --bg:#0b0f17;
      --card:#111827;
      --card2:#0f172a;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --line:rgba(255,255,255,.10);
      --shadow:0 18px 50px rgba(0,0,0,.35);
      --radius:16px;

      --live:#22c55e;
      --up:#f59e0b;
      --soon:#60a5fa;

      --asia: rgba(96,165,250,.14);
      --london: rgba(34,197,94,.12);
      --overlap: rgba(245,158,11,.14);
      --ny: rgba(168,85,247,.14);

      --gold: rgba(245,158,11,.18);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(1200px 800px at 20% 0%, rgba(96,165,250,.10), transparent 60%),
        radial-gradient(900px 700px at 90% 20%, rgba(245,158,11,.10), transparent 60%),
        radial-gradient(900px 700px at 50% 100%, rgba(34,197,94,.08), transparent 60%),
        var(--bg);
      color:var(--text);
    }

    .wrap{max-width:1200px;margin:0 auto;padding:18px 14px 34px}
    .topbar{display:flex;gap:12px;align-items:flex-end;justify-content:space-between;flex-wrap:wrap}
    h1{margin:0;font-size:22px;letter-spacing:.2px}
    .subtitle{color:var(--muted);font-size:12px;margin-top:6px}

    .btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;border-radius:12px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease;
      text-decoration:none;
      display:inline-flex;gap:8px;align-items:center;
    }
    .btn:hover{background:rgba(255,255,255,.06); transform: translateY(-1px);}
    .btn:active{transform: translateY(0px);}

    .grid{display:grid;gap:12px;margin-top:14px}
    .cards{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width: 980px){ .cards{grid-template-columns:1fr} }

    .card{
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      overflow:hidden;
      position:relative;
    }
    .clockLabel{font-size:12px;color:var(--muted)}
    .clockTime{font-size:28px;font-weight:800;letter-spacing:.5px;margin-top:4px}
    .clockMeta{margin-top:6px;font-size:12px;color:var(--muted)}

    .pill{
      display:inline-flex;align-items:center;gap:8px;
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      background:rgba(255,255,255,.03);
    }
    .dot{width:8px;height:8px;border-radius:999px;background:var(--muted);box-shadow:0 0 0 3px rgba(255,255,255,.02)}
    .dot.live{background:var(--live)}
    .dot.up{background:var(--up)}
    .dot.soon{background:var(--soon)}

    .panelTitle{display:flex;align-items:center;justify-content:space-between;margin-top:16px;margin-bottom:8px}
    .panelTitle h2{margin:0;font-size:14px;color:var(--muted);font-weight:700;letter-spacing:.2px}
    .panelTitle .mini{font-size:12px;color:var(--muted)}

    /* Desktop table */
    .tableWrap{
      border:1px solid var(--line);
      background:rgba(255,255,255,.02);
      border-radius:var(--radius);
      overflow:hidden;
    }
    table{width:100%;border-collapse:collapse}
    thead th{
      text-align:left;
      font-size:12px;
      padding:12px 12px;
      color:var(--muted);
      background:rgba(255,255,255,.03);
      border-bottom:1px solid var(--line);
      position:sticky; top:0;
      backdrop-filter: blur(8px);
    }
    tbody td{
      padding:12px 12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      vertical-align:top;
      font-size:13px;
    }
    tbody tr{
      transition: background .15s ease, transform .12s ease;
    }
    tbody tr:hover{background:rgba(255,255,255,.03)}
    tbody tr:last-child td{border-bottom:none}

    .pair{
      display:flex;gap:8px;align-items:center;font-weight:800;
    }
    .goldBadge{
      font-size:11px;
      padding:3px 8px;border-radius:999px;
      border:1px solid rgba(245,158,11,.35);
      background:rgba(245,158,11,.10);
      color:#ffd28a;
    }

    .journalLink{
      margin-left:auto;
      font-size:12px;
      color:var(--muted);
      text-decoration:none;
      border:1px solid var(--line);
      padding:4px 8px;border-radius:10px;
      background:rgba(255,255,255,.02);
      transition: background .12s ease;
      white-space:nowrap;
    }
    .journalLink:hover{background:rgba(255,255,255,.05)}

    .statusPill{
      display:inline-flex;align-items:center;gap:8px;
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      font-weight:800;
    }
    .status-live{border-color:rgba(34,197,94,.35); background:rgba(34,197,94,.10)}
    .status-up{border-color:rgba(245,158,11,.35); background:rgba(245,158,11,.10)}
    .status-soon{border-color:rgba(96,165,250,.35); background:rgba(96,165,250,.10)}

    .heat-asia{background:linear-gradient(90deg,var(--asia), transparent 60%)}
    .heat-london{background:linear-gradient(90deg,var(--london), transparent 60%)}
    .heat-overlap{background:linear-gradient(90deg,var(--overlap), transparent 60%)}
    .heat-ny{background:linear-gradient(90deg,var(--ny), transparent 60%)}
    .heat-gold{box-shadow: inset 0 0 0 9999px var(--gold)}

    /* Mobile cards (hide table) */
    .mobileList{display:none}
    @media (max-width: 900px){
      .tableWrap{display:none}
      .mobileList{display:grid;gap:10px}
      .mCard{
        border:1px solid var(--line);
        border-radius:var(--radius);
        background:rgba(255,255,255,.02);
        padding:12px;
      }
      .mTop{display:flex;gap:10px;align-items:flex-start;justify-content:space-between}
      .mPair{font-weight:900}
      .mMeta{color:var(--muted);font-size:12px;margin-top:3px}
      .mRow{display:flex;gap:10px;margin-top:10px}
      .mK{width:120px;flex:0 0 120px;color:var(--muted);font-size:12px}
      .mV{font-size:12px}
    }

    .searchRow{display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap}
    .search{
      flex:1;
      min-width:220px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      outline:none;
    }
    .toggle{
      display:flex;gap:8px;align-items:center;
      border:1px solid var(--line);
      border-radius:12px;
      padding:8px 10px;
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12px;
    }
    .toggle input{accent-color:#60a5fa}

    .muted{color:var(--muted)}
    .right{display:flex;gap:10px;align-items:center}
  
    /* =========================
       Row expand (keep table uniform)
       ========================= */
    .cellClip{
      max-width: 100%;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:normal;
    }
    tr.isExpandable{cursor:pointer}
    tr.isExpandable.expanded .cellClip{
      -webkit-line-clamp:unset;
      display:block;
      overflow:visible;
    }
    tr.isExpandable.expanded td{
      background: color-mix(in srgb, var(--card) 50%, transparent);
    }

    /* =========================
       Notes panel + gallery
       ========================= */
    .notesWrap{margin-top:14px}
    .notesHeader{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;padding:12px}
    .notesHeader h3{margin:0;font-size:13px;color:var(--muted);font-weight:900;letter-spacing:.22px}
    .chipRow{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .chip{
      border:1px solid var(--line);
      background: color-mix(in srgb, var(--card) 55%, transparent);
      padding:6px 10px;border-radius:999px;
      font-size:11px;color:var(--muted);
      cursor:pointer;
      user-select:none;
      transition: background .12s var(--ease), transform .12s var(--ease);
    }
    .chip:hover{background: color-mix(in srgb, var(--card) 80%, transparent); transform: translateY(-1px);}
    .chip.active{border-color: color-mix(in srgb, var(--accent) 55%, transparent); color: var(--text);}

    .notesGrid{display:grid;gap:10px;padding:12px}
    @media (min-width: 980px){ .notesGrid{grid-template-columns: repeat(2, minmax(0,1fr));} }

    .noteCard{padding:12px}
    .noteTop{display:flex;gap:10px;align-items:flex-start;justify-content:space-between}
    .noteTitle{font-weight:1000}
    .noteText{margin-top:8px;color:var(--text);font-size:12px;line-height:1.35;white-space:pre-wrap}
    .noteTags{margin-top:10px;display:flex;gap:6px;flex-wrap:wrap}
    .tag{
      font-size:10px;
      padding:3px 8px;border-radius:999px;
      border:1px solid var(--line);
      color:var(--muted);
      background: color-mix(in srgb, var(--card) 50%, transparent);
    }

    .imgGrid{margin-top:10px;display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px}
    .imgThumb{
      width:100%;aspect-ratio: 4/3;object-fit:cover;
      border-radius:12px;border:1px solid var(--line);
      cursor:zoom-in;
      background: color-mix(in srgb, var(--card) 60%, transparent);
    }

    .modal{
      position:fixed;inset:0;display:none;place-items:center;
      background: rgba(0,0,0,.55);
      z-index:9999;
      padding:18px;
    }
    .modal.open{display:grid}
    .modalInner{
      max-width: min(1100px, 96vw);
      max-height: min(740px, 88vh);
      border-radius: 18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.18);
      box-shadow: 0 30px 90px rgba(0,0,0,.45);
      background: rgba(0,0,0,.2);
      backdrop-filter: blur(16px);
    }
    .modalInner img{width:100%;height:100%;object-fit:contain;display:block;background:#0b0f1a}
    .modalClose{
      position:fixed;top:14px;right:14px;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(0,0,0,.35);
      color:#fff;
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:900;
    }

    /* =========================
       Fire (gold) - slightly more ‚Äúpro‚Äù
       ========================= */
    .goldBadge:before{
      content:"";
      position:absolute;inset:-40%;
      background:
        radial-gradient(closest-side, color-mix(in srgb, var(--warn) 55%, transparent), transparent 65%),
        radial-gradient(closest-side, color-mix(in srgb, #ff6a00 38%, transparent), transparent 60%);
      opacity:.45;
      filter: blur(10px);
      animation: goldGlow 1.6s var(--ease) infinite;
      pointer-events:none;
    }
    @keyframes goldGlow{
      0%{transform: translate(-6px, 2px) scale(.96); opacity:.35}
      50%{transform: translate(6px, -2px) scale(1.04); opacity:.55}
      100%{transform: translate(-6px, 2px) scale(.96); opacity:.35}
    }

  
/* --- Compact table (overview only) --- */
.tableWrap table{table-layout:fixed;width:100%}
.tableWrap th,.tableWrap td{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.tableWrap tr{height:56px}
.cellHint{display:inline-flex;align-items:center;gap:8px;min-width:0}
.cellHint .hintIcon{opacity:.65;flex:0 0 auto}

/* Pair icon (emoji-only) */
.pairCell{display:flex;align-items:center;gap:10px;min-width:0}
.pairIcon{width:26px;height:26px;border-radius:999px;background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.12);display:grid;place-items:center;flex:0 0 auto}
.pairName{min-width:0;font-weight:900}
.pairName span{display:inline-block;min-width:0;overflow:hidden;text-overflow:ellipsis}

/* Gold badge: animated fire + subtle glow */
.goldBadge{position:relative;overflow:hidden}
.goldBadge .fire{display:inline-block;animation:fireWiggle 1.1s ease-in-out infinite}
@keyframes fireWiggle{0%,100%{transform:translateY(0) rotate(-2deg)}50%{transform:translateY(-1px) rotate(2deg)}}
tr.rowGold{box-shadow: inset 0 0 0 1px rgba(245,158,11,.25), 0 0 22px rgba(245,158,11,.10);}

/* Sticky section headers on mobile */
@media (max-width:920px){
  .sectionTitle{position:sticky;top:10px;z-index:4;backdrop-filter: blur(12px)}
}

/* --- Notes panel --- */
.notesHead{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;flex-wrap:wrap}
.notesControls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.select{border:1px solid var(--line);background:rgba(255,255,255,.06);color:var(--text);border-radius:12px;padding:8px 10px}
.chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.chip{border:1px solid var(--line);background:rgba(255,255,255,.06);color:var(--text);border-radius:999px;padding:6px 10px;cursor:pointer}
.chip.on{border-color:rgba(96,165,250,.65);box-shadow:0 0 0 3px rgba(96,165,250,.12)}
.notesGrid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;margin-top:12px}
.noteCard{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);border-radius:18px;padding:12px}
.noteTop{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
.noteTitle{font-weight:900}
.noteMeta{margin-top:8px;display:flex;gap:6px;flex-wrap:wrap}
.tag{font-size:12px;color:var(--muted);border:1px solid rgba(255,255,255,.12);border-radius:999px;padding:3px 8px;background:rgba(0,0,0,.18)}
.tag.day{color:var(--text)}
.noteBody{margin-top:10px}
.noteText{white-space:pre-wrap;line-height:1.35}
.noteGallery{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.noteImg{width:120px;height:80px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,255,255,.12);cursor:zoom-in}
.btn.mini{padding:6px 10px;border-radius:12px}

/* --- Details modal --- */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:18px;z-index:50;background:rgba(0,0,0,.45);backdrop-filter: blur(10px)}
.modal.open{display:flex}
.modalInner{width:min(940px,100%);background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));border:1px solid rgba(255,255,255,.16);border-radius:22px;box-shadow:0 20px 60px rgba(0,0,0,.45);padding:18px}
.modalHead{display:flex;align-items:flex-start;justify-content:space-between;gap:14px;margin-bottom:14px}
.dmTitle{font-size:20px;font-weight:900;letter-spacing:.2px}
.dmSub{color:var(--muted);font-size:12px;margin-top:2px}
.dmGrid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;margin-bottom:12px}
.dmCard{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);border-radius:16px;padding:12px}
.dmLabel{color:var(--muted);font-size:12px}
.dmVal{font-size:16px;font-weight:800;margin-top:6px}
.dmSmall{color:var(--muted);font-size:12px;margin-top:6px}
.dmSplit{display:grid;grid-template-columns:1fr;gap:12px}
.dmBlock{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);border-radius:16px;padding:12px}
.dmLabelRow{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px}
.dmActions{display:flex;gap:8px;flex-wrap:wrap}
.dmText{white-space:pre-wrap;line-height:1.35;padding:10px;border-radius:14px;background:rgba(0,0,0,.20);border:1px solid rgba(255,255,255,.10);min-height:72px}
.dmTextarea{width:100%;min-height:120px;resize:vertical;padding:10px;border-radius:14px;background:rgba(0,0,0,.20);border:1px solid rgba(255,255,255,.10);color:var(--text);outline:none}
.dmTextarea[readonly]{opacity:.85}
.dmHint{color:var(--muted);font-size:12px;margin-top:8px}
.dmFoot{display:flex;justify-content:flex-end;margin-top:12px}
@media (max-width:820px){.dmGrid{grid-template-columns:1fr}.modalInner{padding:14px}.notesGrid{grid-template-columns:1fr}}

</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <h1>Trading Sessions Dashboard</h1>
        <div class="subtitle">Live clocks ‚Ä¢ live windows ‚Ä¢ countdowns (Paris-based) ‚Ä¢ mobile-first</div>
      </div>
      <div class="right">
        <a class="btn" href="./editor.html" title="Edit config">
          ‚úèÔ∏è <span>Open Editor</span>
        </a>
      </div>
    </div>

    <div class="grid cards">
      <div class="card" id="cardParis">
        <div class="clockLabel">Paris Time</div>
        <div class="clockTime" id="tParis">--:--:--</div>
        <div class="clockMeta" id="dParis">--</div>
      </div>

      <div class="card" id="cardNY">
        <div class="clockLabel">New York Time</div>
        <div class="clockTime" id="tNY">--:--:--</div>
        <div class="clockMeta" id="dNY">--</div>
      </div>

      <div class="card" id="cardIST">
        <div class="clockLabel">IST Time</div>
        <div class="clockTime" id="tIST">--:--:--</div>
        <div class="clockMeta" id="dIST">--</div>
      </div>
    </div>

    <div class="searchRow">
      <input class="search" id="q" placeholder="Search pair / session (e.g., XAUUSD, London, overlap)..." />
      <label class="toggle" title="Show only LIVE rows">
        <input type="checkbox" id="onlyLive" />
        Only LIVE
      </label>
      <label class="toggle" title="Show only GOLDEN rows">
        <input type="checkbox" id="onlyGold" />
        Only GOLDEN
      </label>
      <label class="toggle" title="Notify me when a session becomes LIVE">
        <input type="checkbox" id="notifyToggle" />
        Notifications
      </label>
    </div>

    
    <div class="notesWrap glass" id="notesPanel">
      <div class="notesHeader">
        <h3>NOTES (Day + tags)</h3>
        <div class="chipRow">
          <div class="selectWrap" title="Day">
            <select class="select" id="notesDay">
              <option value="Mon">Mon</option>
              <option value="Tue">Tue</option>
              <option value="Wed">Wed</option>
              <option value="Thu">Thu</option>
              <option value="Fri">Fri</option>
              <option value="Sat">Sat</option>
              <option value="Sun">Sun</option>
            </select>
          </div>
          <input class="search" style="max-width:240px" id="tagSearch" placeholder="Filter tags..." />
        </div>
      </div>
      <div class="notesHeader" style="padding-top:0;border-top:1px solid var(--line);border-radius:0 0 var(--radius) var(--radius);">
        <div class="chipRow" id="tagChips"></div>
        <div class="mini muted" id="notesMeta">‚Äî</div>
      </div>
      <div class="notesGrid" id="notesGrid"></div>
    </div>

    <div class="modal" id="imgModal" aria-hidden="true">
      <button class="modalClose" id="modalClose">‚úï</button>
      <div class="modalInner glass"><img id="modalImg" alt="Note image" /></div>
    </div>


    <div class="panelTitle">
      <h2>LIVE NOW</h2>
      <div class="mini" id="liveMeta">‚Äî</div>
    </div>

    <div class="mobileList" id="liveMobile"></div>
    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th style="width:170px">Session</th>
            <th style="width:250px">Pair</th>
            <th style="width:130px">Chart TF</th>
            <th style="width:190px">Best Window (Paris)</th>
            <th style="width:190px">IST Window</th>
            <th style="width:120px">Status</th>
            <th style="width:170px">Countdown</th>
            <th style="width:240px">Tight Rules</th>
            <th>Comments</th>
          </tr>
        </thead>
        <tbody id="liveBody"></tbody>
      </table>
    </div>

    <div class="panelTitle">
      <h2>ALL PAIRS</h2>
      <div class="mini muted">Auto updates every second</div>
    </div>

    <div class="mobileList" id="allMobile"></div>
    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th style="width:170px">Session</th>
            <th style="width:250px">Pair</th>
            <th style="width:130px">Chart TF</th>
            <th style="width:190px">Best Window (Paris)</th>
            <th style="width:190px">IST Window</th>
            <th style="width:120px">Status</th>
            <th style="width:170px">Countdown</th>
            <th style="width:240px">Tight Rules</th>
            <th>Comments</th>
          </tr>
        </thead>
        <tbody id="allBody"></tbody>
      </table>
    </div>
  </div>

<script>
  const TZ_PARIS = "Europe/Paris";
  const TZ_NY = "America/New_York";
  const TZ_IST = "Asia/Kolkata";

  function fmtTime(tz){
    return new Intl.DateTimeFormat("en-GB", { timeZone: tz, hour:"2-digit", minute:"2-digit", second:"2-digit" });
  }
  function fmtDate(tz){
    return new Intl.DateTimeFormat("en-GB", { timeZone: tz, weekday:"short", day:"2-digit", month:"short", year:"numeric" });
  }
  const fParis = fmtTime(TZ_PARIS), fNY = fmtTime(TZ_NY), fIST = fmtTime(TZ_IST);
  const dParisF = fmtDate(TZ_PARIS), dNYF = fmtDate(TZ_NY), dISTF = fmtDate(TZ_IST);

  function parseHHMM(s){
    // supports "00H30", "00:30", "00H30 " etc.
    const t = s.trim().toUpperCase().replace(":", "H");
    const [hh, mm] = t.split("H");
    return { h: Number(hh), m: Number(mm) };
  }

  function windowsFromText(text){
    // "01H00 - 05H00 / 14H00 - 18H00"
    return String(text||"")
      .split("/")
      .map(x => x.trim())
      .filter(Boolean)
      .map(seg=>{
        const [a,b] = seg.split("-").map(x=>x.trim());
        if(!a || !b) return null;
        const s = parseHHMM(a);
        const e = parseHHMM(b);
        return { s, e, label: `${a} - ${b}` };
      })
      .filter(Boolean);
  }

  function nowInTZ(tz){
    // get "now" parts in tz by formatting and re-parsing (safe enough for daily windows)
    const parts = new Intl.DateTimeFormat("en-GB", {
      timeZone: tz, year:"numeric", month:"2-digit", day:"2-digit",
      hour:"2-digit", minute:"2-digit", second:"2-digit", hour12:false
    }).formatToParts(new Date()).reduce((acc,p)=> (acc[p.type]=p.value, acc), {});
    const y = Number(parts.year), mo = Number(parts.month), d = Number(parts.day);
    const h = Number(parts.hour), mi = Number(parts.minute), se = Number(parts.second);
    return { y, mo, d, h, mi, se };
  }

  function msUntilInParis(targetHM){
    // milliseconds until today's (or tomorrow's) target time in Paris tz
    const n = nowInTZ(TZ_PARIS);
    const now = Date.now();
    const target = new Date(`${n.y}-${String(n.mo).padStart(2,"0")}-${String(n.d).padStart(2,"0")}T00:00:00`);
    // target is local time; we just need relative comparisons, so we compute using minutes in tz via parts:
    // We'll compute diff purely by hm minutes in paris day:
    const nowMin = n.h*60 + n.mi + n.se/60;
    const tMin = targetHM.h*60 + targetHM.m;
    let deltaMin = tMin - nowMin;
    if(deltaMin < 0) deltaMin += 24*60; // tomorrow
    return Math.max(0, deltaMin*60*1000);
  }

  function withinWindowParis(win){
    const n = nowInTZ(TZ_PARIS);
    const nowMin = n.h*60 + n.mi + n.se/60;
    const sMin = win.s.h*60 + win.s.m;
    const eMin = win.e.h*60 + win.e.m;
    // handle wrap-around windows (rare)
    if(eMin >= sMin) return nowMin >= sMin && nowMin <= eMin;
    return (nowMin >= sMin) || (nowMin <= eMin);
  }

  function countdownForRow(wins){
    // wins = [{s,e,label}, ...] in Paris time
    // status:
    // LIVE if within any window
    // otherwise UPCOMING (starts in)
    // countdown = ends in / starts in for nearest relevant
    const live = wins.find(withinWindowParis);
    if(live){
      // ends in
      const ms = msUntilInParis(live.e);
      return { status:"LIVE", ms, mode:"ends" };
    }
    // next start (choose minimum ms until start)
    let best = null;
    for(const w of wins){
      const ms = msUntilInParis(w.s);
      if(best === null || ms < best) best = ms;
    }
    return { status:"UPCOMING", ms: best ?? 0, mode:"starts" };
  }

  function msToHHMMSS(ms){
    const total = Math.max(0, Math.floor(ms/1000));
    const h = Math.floor(total/3600);
    const m = Math.floor((total%3600)/60);
    const s = total%60;
    const pad = n => String(n).padStart(2,"0");
    return `${pad(h)}:${pad(m)}:${pad(s)}`;
  }

  function heatClass(session, golden){
    const s = (session||"").toLowerCase();
    let c = "";
    if(s.includes("asian")) c = "heat-asia";
    else if(s.includes("london") && s.includes("overlap")) c = "heat-overlap";
    else if(s.includes("london")) c = "heat-london";
    else if(s.includes("new york")) c = "heat-ny";
    if(golden) c += " heat-gold";
    return c.trim();
  }

  function statusPill(status){
    if(status === "LIVE") return `<span class="statusPill status-live"><span class="dot live"></span>LIVE</span>`;
    return `<span class="statusPill status-up"><span class="dot up"></span>UPCOMING</span>`;
  }

  function journalAnchor(url){
    if(!url) return "";
    return `<a class="journalLink" href="${url}" target="_blank" rel="noopener">Journal ‚Üó</a>`;
  }

  
  function rowHTML(r, liveOnly=false, idx=0){
    const id = rowIdFor(r, idx);
    const wins = windowsFromText(r.bestWindowParis);
    const cd = countdownForRow(wins);
    const countdownTxt = `${cd.mode} in ${msToHHMMSS(cd.ms)}`;

    const isLive = cd.status === "LIVE";
    if(liveOnly && !isLive) return "";

    const heat = heatClass(r.session, !!r.golden);
    const gold = r.golden ? ` <span class="goldBadge"><span class="fire">üî•</span> GOLD</span>` : "";
    const icon = pairEmoji(r.pair);
    const statusChip = statusPill(cd.status);

    __rowById[id] = r;
    __stateById[id] = { status: cd.status, statusLabel: cd.status, statusChip, countdownText: countdownTxt };

    const shortRules = (r.tightRules||"").replace(/\n+/g," ‚Ä¢ ").trim();
    const shortComments = (r.comments||"").replace(/\n+/g," ‚Ä¢ ").trim();

    return `
      <tr class="${heat} ${r.golden ? 'rowGold' : ''}" data-rowid="${id}" tabindex="0" role="button" aria-label="Open details for ${r.pair||''}">
        <td>${r.session||""}</td>
        <td>
          <div class="pairCell">
            <div class="pairIcon" aria-hidden="true">${icon}</div>
            <div class="pairName"><span>${(r.pair||"")}</span>${gold}</div>
          </div>
        </td>
        <td>${r.chartTF||""}</td>
        <td>${r.bestWindowParis||""}</td>
        <td>${r.istWindow||""}</td>
        <td>${statusChip}</td>
        <td>${countdownTxt}</td>
        <td><span class="cellHint"><span class="hintIcon">‚Üó</span><span>${escapeHTML(shortRules)}</span></span></td>
        <td><span class="cellHint"><span class="hintIcon">‚Üó</span><span>${escapeHTML(shortComments)}</span></span></td>
      </tr>
    `;
  }

  function mobileCardHTML(r, idx=0){
    const id = rowIdFor(r, idx);
    const wins = windowsFromText(r.bestWindowParis);
    const cd = countdownForRow(wins);
    const heat = heatClass(r.session, !!r.golden);
    const gold = r.golden ? ` <span class="goldBadge"><span class="fire">üî•</span> GOLD</span>` : "";
    const j = r.journal ? `<a class="journalLink" href="${r.journal}" target="_blank" rel="noopener">Journal ‚Üó</a>` : "";
    const countdownTxt = `${cd.mode} in ${msToHHMMSS(cd.ms)}`;
    const icon = pairEmoji(r.pair);

    __rowById[id] = r;
    __stateById[id] = { status: cd.status, statusLabel: cd.status, statusChip: statusPill(cd.status), countdownText: countdownTxt };

    return `
      <div class="mCard ${heat} ${r.golden ? 'rowGold' : ''}" data-rowid="${id}" role="button" tabindex="0" aria-label="Open details for ${r.pair||''}">
        <div class="mTop">
          <div>
            <div class="mPair">${icon} ${(r.pair||"")} ${gold}</div>
            <div class="mMeta">${r.session||""} ‚Ä¢ TF: ${r.chartTF||""}</div>
          </div>
          <div>${statusPill(cd.status)}</div>
        </div>
        <div class="mGrid">
          <div><div class="mLbl">Best (Paris)</div><div class="mVal">${r.bestWindowParis||""}</div></div>
          <div><div class="mLbl">IST</div><div class="mVal">${r.istWindow||""}</div></div>
          <div><div class="mLbl">Countdown</div><div class="mVal">${countdownTxt}</div></div>
        </div>
        <div class="mBottom">
          ${j}
          <span class="muted">Tap to view rules, comments & notes</span>
        </div>
      </div>
    `;
  }

  function pairEmoji(pair){
    const p = (pair||"").toUpperCase();
    if(p.includes("XAU")) return "üü°";
    if(p.includes("GBP")) return "üá¨üáß";
    if(p.includes("EUR")) return "üá™üá∫";
    if(p.includes("JPY")) return "üáØüáµ";
    if(p.includes("AUD")) return "üá¶üá∫";
    if(p.includes("NZD")) return "üá≥üáø";
    if(p.includes("CAD")) return "üá®üá¶";
    if(p.includes("USD")) return "üá∫üá∏";
    return "üí±";
  }


  async function loadConfig(){
    const res = await fetch("./config.json?x=" + Date.now());
    const json = await res.json();
    if(!json.rows) json.rows = [];
    // normalize fields
    json.rows = json.rows.map(r=>({
      session: r.session ?? "",
      pair: r.pair ?? "",
      chartTF: r.chartTF ?? r.chartTimeFrame ?? "",
      bestWindowParis: r.bestWindowParis ?? r.bestCTE ?? "",
      istWindow: r.istWindow ?? "",
      golden: !!r.golden,
      tightRules: r.tightRules ?? "",
      comments: r.comments ?? "",
      journal: r.journal ?? ""
    }));
    return json;
  }


  // =========================
  // Notes (notes.json)
  // =========================
  let NOTES = {}; // {Mon:[{title,tags,text,images}], ...}
  const NOTES_TAG_KEY = "tsd_notes_tags_v1";

  function parisWeekdayShort(){
    const s = new Intl.DateTimeFormat("en-GB",{ timeZone: TZ_PARIS, weekday:"short" }).format(new Date());
    // en-GB gives Mon/Tue/... perfect
    return s;
  }

  function uniq(arr){ return Array.from(new Set(arr)); }

  function loadSelectedTags(){
    try{ return JSON.parse(localStorage.getItem(NOTES_TAG_KEY) || "[]"); }catch(e){ return []; }
  }
  function saveSelectedTags(tags){
    localStorage.setItem(NOTES_TAG_KEY, JSON.stringify(tags));
  }

  async function loadNotes(){
    try{
      const res = await fetch("./notes.json?x=" + Date.now());
      NOTES = await res.json();
    }catch(e){
      NOTES = {};
    }
  }

  function noteCardHTML(n){
    const tags = (n.tags||[]).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join("");
    const imgs = (n.images||[]).map(src=>`<img class="imgThumb" src="${src}" data-img="${src}" alt="note image" />`).join("");
    const hasImgs = (n.images||[]).length > 0;
    const body = `
      <div class="noteCard glass">
        <div class="noteTop">
          <div>
            <div class="noteTitle">${escapeHtml(n.title||"Note")}</div>
            <div class="noteText">${escapeHtml(n.text||"")}</div>
            <div class="noteTags">${tags}</div>
          </div>
          <div class="muted" style="font-size:12px">üìå</div>
        </div>
        ${hasImgs ? `<div class="imgGrid">${imgs}</div>` : ``}
      </div>
    `;
    return body;
  }

  function renderNotes(){
    const panel = document.getElementById("notesPanel");
    if(!panel) return;

    const day = document.getElementById("notesDay").value;
    const tagQ = document.getElementById("tagSearch").value.trim().toLowerCase();

    const dayNotes = Array.isArray(NOTES?.[day]) ? NOTES[day] : [];
    const allTags = uniq(dayNotes.flatMap(n => (n.tags||[])));

    let selected = loadSelectedTags();
    // keep only tags present today
    selected = selected.filter(t => allTags.includes(t));

    // build chips (filtered by tag search)
    const chipContainer = document.getElementById("tagChips");
    const visibleTags = allTags.filter(t => !tagQ || t.toLowerCase().includes(tagQ));
    chipContainer.innerHTML = visibleTags.map(t => {
      const active = selected.includes(t) ? "active" : "";
      return `<span class="chip ${active}" data-tag="${escapeHtml(t)}">${escapeHtml(t)}</span>`;
    }).join("") || `<span class="muted" style="font-size:12px">No tags for ${day} yet.</span>`;

    // filter notes by selected tags
    let notes = dayNotes.slice();
    if(selected.length){
      notes = notes.filter(n => selected.every(t => (n.tags||[]).includes(t)));
    }

    document.getElementById("notesMeta").textContent = `${notes.length} note(s)`;

    const grid = document.getElementById("notesGrid");
    grid.innerHTML = notes.map(noteCardHTML).join("") || `<div class="muted">No notes for this day (or filters).</div>`;

    // persist selection
    saveSelectedTags(selected);
  }

  // =========================
  // Notifications (LIVE)
  // =========================
  const NOTIFY_KEY = "tsd_notify_v1";
  let prevLiveIds = new Set();

  function notifyEnabled(){
    return localStorage.getItem(NOTIFY_KEY) === "1";
  }

  async function requestNotifyPermission(){
    if(!("Notification" in window)) return false;
    if(Notification.permission === "granted") return true;
    if(Notification.permission === "denied") return false;
    const p = await Notification.requestPermission();
    return p === "granted";
  }

  function sendLiveNotification(rows){
    if(!rows.length) return;
    const title = "Session LIVE";
    const body = rows.length === 1
      ? `${rows[0].pair} is LIVE now (${rows[0].session})`
      : `${rows.length} pairs are LIVE now`;
    try{
      if("Notification" in window && Notification.permission === "granted"){
        new Notification(title, { body });
      }else{
        alert(body);
      }
    }catch(e){
      // fallback
      alert(body);
    }
  }


  function render(){
    const q = document.getElementById("q").value.trim().toLowerCase();
    const onlyLive = document.getElementById("onlyLive").checked;
    const onlyGold = document.getElementById("onlyGold").checked;
    __rowById = {}; __stateById = {};

    let rows = CFG.rows.slice();
    if(q){
      rows = rows.filter(r =>
        (r.pair||"").toLowerCase().includes(q) ||
        (r.session||"").toLowerCase().includes(q) ||
        (r.comments||"").toLowerCase().includes(q)
      );
    }
    if(onlyGold){
      rows = rows.filter(r => !!r.golden);
    }

    // compute live rows
    const liveRows = rows.filter(r => countdownForRow(windowsFromText(r.bestWindowParis)).status === "LIVE");
    document.getElementById("liveMeta").textContent = `${liveRows.length} live pair(s)`;

    // notify on NEW LIVE rows
    try{
      const liveIds = new Set(liveRows.map(r => `${(r.session||"").trim()}|${(r.pair||"").trim()}|${(r.bestWindowParis||"").trim()}`));
      const newlyLive = liveRows.filter(r => !prevLiveIds.has(`${(r.session||"").trim()}|${(r.pair||"").trim()}|${(r.bestWindowParis||"").trim()}`));
      if(notifyEnabled() && newlyLive.length){
        // only notify if tab is visible OR user explicitly enabled (we still notify either way)
        sendLiveNotification(newlyLive);
      }
      prevLiveIds = liveIds;
    }catch(e){}


    // LIVE table
    document.getElementById("liveBody").innerHTML = liveRows.map((r,i) => rowHTML(r, true, i)).join("") || `
      <tr><td colspan="9" class="muted">No LIVE pairs right now.</td></tr>
    `;
    document.getElementById("liveMobile").innerHTML = liveRows.map(mobileCardHTML).join("") || `<div class="muted">No LIVE pairs right now.</div>`;

    // ALL table (optionally live only)
    const finalRows = onlyLive ? liveRows : rows;

    document.getElementById("allBody").innerHTML = finalRows.map((r,i) => rowHTML(r, false, i)).join("") || `
      <tr><td colspan="9" class="muted">No rows match your filters.</td></tr>
    `;
    document.getElementById("allMobile").innerHTML = finalRows.map(mobileCardHTML).join("") || `<div class="muted">No rows match your filters.</div>`;

    tickDetailsModal();
    maybeFireLiveNotifications();
  }

  function tickClocks(){
    const now = new Date();
    document.getElementById("tParis").textContent = fParis.format(now);
    document.getElementById("tNY").textContent = fNY.format(now);
    document.getElementById("tIST").textContent = fIST.format(now);

    document.getElementById("dParis").textContent = `${dParisF.format(now)} ‚Ä¢ ${TZ_PARIS}`;
    document.getElementById("dNY").textContent = `${dNYF.format(now)} ‚Ä¢ ${TZ_NY}`;
    document.getElementById("dIST").textContent = `${dISTF.format(now)} ‚Ä¢ ${TZ_IST}`;
  }

  
// -------------------- Row Details Modal (single modal) --------------------
let __rowById = {};      // id -> row object
let __stateById = {};    // id -> computed state (status, countdown text)
let __activeRowId = null;
let __editingNotes = false;
let __notesDraft = "";

function rowIdFor(r, idx){
  if(r && r.id) return String(r.id);
  return `${(r.session||'').replace(/\s+/g,'_')}__${(r.pair||'').replace(/\s+/g,'_')}__${idx}`;
}
function userNotesKey(rowId){ return `tsd_usernotes_v1:${rowId}`; }

function openDetailsModal(rowId){
  __activeRowId = rowId;
  __editingNotes = false;
  renderDetailsModal();
  const modal = document.getElementById('detailsModal');
  modal.classList.add('open');
  modal.setAttribute('aria-hidden','false');
}
function closeDetailsModal(){
  const modal = document.getElementById('detailsModal');
  modal.classList.remove('open');
  modal.setAttribute('aria-hidden','true');
  __activeRowId = null;
  __editingNotes = false;
}
function setNotesEditMode(on){
  __editingNotes = on;
  const ta = document.getElementById('dmUserNotes');
  const btnEdit = document.getElementById('dmEditBtn');
  const btnSave = document.getElementById('dmSaveBtn');
  const btnCancel = document.getElementById('dmCancelBtn');
  if(on){
    __notesDraft = ta.value;
    ta.removeAttribute('readonly');
    ta.focus();
    btnEdit.disabled = true;
    btnSave.disabled = false;
    btnCancel.disabled = false;
  }else{
    ta.setAttribute('readonly','readonly');
    btnEdit.disabled = false;
    btnSave.disabled = true;
    btnCancel.disabled = true;
  }
}
function renderDetailsModal(){
  if(!__activeRowId) return;
  const r = __rowById[__activeRowId];
  const st = __stateById[__activeRowId] || {};
  if(!r) return;

  document.getElementById('dmTitle').textContent = `${pairEmoji(r.pair)} ${r.pair || '‚Äî'}`;
  document.getElementById('dmSub').textContent = `${r.session || '‚Äî'} ‚Ä¢ ${st.statusLabel || '‚Äî'}`;
  document.getElementById('dmStatus').innerHTML = st.statusChip || '‚Äî';
  document.getElementById('dmCountdown').textContent = st.countdownText || '‚Äî';
  document.getElementById('dmTF').textContent = r.chartTF || '‚Äî';
  document.getElementById('dmBest').textContent = r.bestWindowParis || '‚Äî';
  document.getElementById('dmIST').textContent = r.istWindow || '‚Äî';
  document.getElementById('dmGolden').innerHTML = r.golden ? `<span class="goldBadge"><span class="fire">üî•</span> GOLD</span>` : '‚Äî';
  document.getElementById('dmRules').textContent = (r.tightRules || '').trim() || '‚Äî';
  document.getElementById('dmComments').textContent = (r.comments || '').trim() || '‚Äî';

  const journalBtn = document.getElementById('dmJournalBtn');
  if(r.journal){
    journalBtn.style.display = 'inline-flex';
    journalBtn.href = r.journal;
  }else{
    journalBtn.style.display = 'none';
    journalBtn.href = '#';
  }

  const ta = document.getElementById('dmUserNotes');
  if(!__editingNotes){
    ta.value = localStorage.getItem(userNotesKey(__activeRowId)) || '';
    ta.setAttribute('readonly','readonly');
  }
}
function tickDetailsModal(){
  if(!__activeRowId) return;
  const st = __stateById[__activeRowId];
  if(!st) return;
  const cd = document.getElementById('dmCountdown');
  const sub = document.getElementById('dmSub');
  if(cd) cd.textContent = st.countdownText || '‚Äî';
  if(sub){
    const r = __rowById[__activeRowId];
    if(r) sub.textContent = `${r.session || '‚Äî'} ‚Ä¢ ${st.statusLabel || '‚Äî'}`;
  }
}
// -------------------------------------------------------------------------


// -------------------- Notifications (LIVE alerts) --------------------
let __prevLiveSet = new Set();
const LS_NOTIFY_ENABLED = "tsd_notify_enabled_v1";
const LS_NOTIFY_PERMISSION = "tsd_notify_permission_v1";

function notifyEnabled(){ return localStorage.getItem(LS_NOTIFY_ENABLED) === "1"; }

async function ensureNotifyPermission(){
  if(!("Notification" in window)) return {ok:false, reason:"unsupported"};
  const stored = localStorage.getItem(LS_NOTIFY_PERMISSION);
  if(stored === "denied") return {ok:false, reason:"denied"};
  if(Notification.permission === "granted"){
    localStorage.setItem(LS_NOTIFY_PERMISSION, "granted");
    return {ok:true};
  }
  const res = await Notification.requestPermission();
  localStorage.setItem(LS_NOTIFY_PERMISSION, res);
  return {ok: res === "granted", reason:res};
}

function maybeFireLiveNotifications(){
  if(!notifyEnabled()) return;
  const nowLive = new Set(Object.entries(__stateById)
    .filter(([id, st]) => st && st.status === "LIVE")
    .map(([id]) => id)
  );
  for(const id of nowLive){
    if(!__prevLiveSet.has(id)){
      const r = __rowById[id];
      const title = `LIVE: ${r?.pair || "Pair"} (${r?.session || ""})`;
      const body = `Best (Paris): ${r?.bestWindowParis || ""}\nIST: ${r?.istWindow || ""}`;
      if("Notification" in window && Notification.permission === "granted"){
        try{ new Notification(title, { body }); }
        catch(e){ alert(title + "\\n" + body); }
      }else{
        alert(title + "\\n" + body);
      }
    }
  }
  __prevLiveSet = nowLive;
}
// --------------------------------------------------------------------


// -------------------- Notes Panel (notes.json) --------------------
let __notesData = [];
let __notesSelectedTags = new Set();

async function loadNotesJSON(){
  try{
    const res = await fetch("notes.json", {cache:"no-store"});
    if(!res.ok) throw new Error("notes.json not found");
    const data = await res.json();
    __notesData = Array.isArray(data) ? data : (data.notes || []);
  }catch(e){
    console.warn("Notes load failed:", e);
    __notesData = [];
  }
  renderNotesPanel();
}

function weekdayKeyFromDate(d){
  const map = ["sun","mon","tue","wed","thu","fri","sat"];
  return map[d.getDay()];
}

function escapeHTML(s){
  return (s||"").replace(/[&<>"']/g, (c)=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));
}

function noteMatchesFilters(note){
  const daySel = document.getElementById("notesDay")?.value || "all";
  const q = (document.getElementById("notesTagSearch")?.value || "").trim().toLowerCase();
  const days = Array.isArray(note.days) ? note.days : (note.day ? [note.day] : []);
  const dayOk = daySel === "all" ? true : days.includes(daySel);
  const tagArr = Array.isArray(note.tags) ? note.tags : [];
  const tagsOk = __notesSelectedTags.size === 0 ? true : [...__notesSelectedTags].every(t => tagArr.map(x=>String(x).toLowerCase()).includes(String(t).toLowerCase()));
  const qOk = !q ? true : (tagArr.join(" ").toLowerCase().includes(q) || String(note.title||"").toLowerCase().includes(q) || String(note.text||"").toLowerCase().includes(q));
  return dayOk && tagsOk && qOk;
}

function collectAllTags(notes){
  const set = new Set();
  for(const n of notes){
    for(const t of (n.tags||[])) set.add(String(t));
  }
  return [...set].sort((a,b)=>a.localeCompare(b));
}

function renderNotesPanel(){
  const grid = document.getElementById("notesGrid");
  const chips = document.getElementById("notesChips");
  if(!grid || !chips) return;

  const filtered = __notesData.filter(noteMatchesFilters);
  const tags = collectAllTags(__notesData);

  chips.innerHTML = tags.map(t=>{
    const on = __notesSelectedTags.has(t);
    return `<button class="chip ${on?'on':''}" data-tag="${escapeHTML(t)}">#${escapeHTML(t)}</button>`;
  }).join("");

  if(filtered.length===0){
    grid.innerHTML = `<div class="muted">No notes match your filters.</div>`;
    return;
  }

  grid.innerHTML = filtered.map((n, i)=>{
    const title = escapeHTML(n.title || "Note");
    const text = escapeHTML(n.text || "");
    const tagsHtml = (n.tags||[]).map(t=>`<span class="tag">#${escapeHTML(t)}</span>`).join("");
    const imgs = (n.images||[]).map(src=>`<img class="noteImg" src="${escapeHTML(src)}" alt="screenshot" loading="lazy" data-img="${escapeHTML(src)}"/>`).join("");
    const days = (Array.isArray(n.days)?n.days:(n.day?[n.day]:[])).map(d=>`<span class="tag day">${escapeHTML(d.toUpperCase())}</span>`).join("");
    return `
      <div class="noteCard" data-note="${i}">
        <div class="noteTop">
          <div class="noteTitle">${title}</div>
          <button class="btn mini" data-action="toggleNote">Expand</button>
        </div>
        <div class="noteMeta">${days} ${tagsHtml}</div>
        <div class="noteBody" hidden>
          <div class="noteText">${text || "<span class='muted'>No text</span>"}</div>
          ${imgs ? `<div class="noteGallery">${imgs}</div>` : ""}
        </div>
      </div>
    `;
  }).join("");
}
// --------------------------------------------------------------------

async function main(){
    CFG = await loadConfig();
    tickClocks();
    render();
    setInterval(()=>{ tickClocks(); render(); }, 1000);

    document.getElementById("q").addEventListener("input", render);
    document.getElementById("onlyLive").addEventListener("change", render);
    document.getElementById("onlyGold").addEventListener("change", render);
  }
  main();
</script>

  <!-- Details Modal (single source of truth for full row details) -->
  <div class="modal" id="detailsModal" aria-hidden="true">
    <div class="modalInner" role="dialog" aria-modal="true" aria-labelledby="dmTitle">
      <div class="modalHead">
        <div>
          <div class="dmTitle" id="dmTitle">Pair</div>
          <div class="dmSub" id="dmSub">Session ‚Ä¢ Status</div>
        </div>
        <button class="btn" id="dmCloseBtn">‚úï</button>
      </div>

      <div class="dmGrid">
        <div class="dmCard">
          <div class="dmLabel">Status</div>
          <div class="dmVal" id="dmStatus">‚Äî</div>
          <div class="dmSmall" id="dmCountdown">‚Äî</div>
        </div>
        <div class="dmCard">
          <div class="dmLabel">Chart TF</div>
          <div class="dmVal" id="dmTF">‚Äî</div>
          <div class="dmSmall">Best (Paris): <span id="dmBest">‚Äî</span></div>
        </div>
        <div class="dmCard">
          <div class="dmLabel">IST Window</div>
          <div class="dmVal" id="dmIST">‚Äî</div>
          <div class="dmSmall" id="dmGolden">‚Äî</div>
        </div>
      </div>

      <div class="dmSplit">
        <div class="dmBlock">
          <div class="dmLabelRow">
            <div class="dmLabel">Tight Rules</div>
          </div>
          <div class="dmText" id="dmRules"></div>
        </div>

        <div class="dmBlock">
          <div class="dmLabelRow">
            <div class="dmLabel">Comments</div>
          </div>
          <div class="dmText" id="dmComments"></div>
        </div>

        <div class="dmBlock">
          <div class="dmLabelRow">
            <div class="dmLabel">Notes (your editable notes)</div>
            <div class="dmActions">
              <button class="btn" id="dmEditBtn">Edit</button>
              <button class="btn" id="dmSaveBtn" disabled>Save</button>
              <button class="btn" id="dmCancelBtn" disabled>Cancel</button>
            </div>
          </div>
          <textarea class="dmTextarea" id="dmUserNotes" placeholder="Write your personal notes for this pair/session..." readonly></textarea>
          <div class="dmHint">Stored in your browser (no backend). Use Git commits for versioned backups.</div>
        </div>
      </div>

      <div class="dmFoot">
        <a class="btn" id="dmJournalBtn" href="#" target="_blank" rel="noopener" style="display:none;">Open Journal ‚Üó</a>
      </div>
    </div>
  </div>

</body>
</html>
